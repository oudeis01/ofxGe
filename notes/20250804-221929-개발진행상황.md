# GLSL 플러그인 시스템 개발 진행 보고서
**날짜: 2025년 8월 4일**  
**프로젝트: OpenFrameworks GLSL 플러그인 시스템 - Swizzle 지원 및 빌트인 변수 시스템**

## 📋 오늘 완료된 작업

### 1. **빌트인 변수 관리 시스템 구축**
- **BuiltinVariables.h/cpp** 별도 파일로 분리 생성
- **지원 빌트인 변수**: `st`, `time`, `resolution`, `gl_FragCoord`
- **각 변수별 메타데이터**: 타입, 성분 수, 유니폼 필요 여부, 선언 필요 여부, 선언 코드
- **싱글톤 패턴**으로 전역 접근 가능

### 2. **Swizzle 파싱 및 처리 로직**  
- **swizzle 감지**: `st.x`, `st.xy` 등 점(.) 포함 변수 인식
- **기본 변수 추출**: `st.x` → `st` 
- **swizzle 부분 추출**: `st.xy` → `xy`
- **타입 자동 결정**: swizzle 길이에 따라 `float`, `vec2`, `vec3`, `vec4`

### 3. **타입 시스템 개선**
- **성분 수 계산 정교화**: `st`(2개) + `time`(1개) + `1.0`(1개) = 4개 성분
- **swizzle 성분 수 반영**: `st.x`(1개) + `time`(1개) + `1.0`(1개) = 3개 성분
- **오버로드 선택 개선**: 성분 수 기반으로 `vec2`, `vec3`, `vec4` 정확히 매칭

### 4. **래핑 함수 생성 시스템 완전 수정**
- **매개변수 이름 안전성**: `st.x` → `st_x` (점을 언더바로 변경)
- **리터럴 매개변수 지원**: `1.0` → `literal_0`, `literal_1` 등
- **타입 매핑**: swizzle 길이에 따른 정확한 타입 결정
- **함수 내부 매개변수명 사용**: 실제 매개변수명으로 벡터 생성자 호출

### 5. **유니폼 생성 로직 개선**
- **swizzle 유니폼 제외**: `st.x`가 `st.x` 유니폼을 생성하지 않도록 수정
- **빌트인 종속성 관리**: `st` 사용 시 `resolution` 유니폼 자동 추가
- **리터럴 제외**: 리터럴 상수는 유니폼에서 제외

### 6. **메인 함수 선언 자동화**
- **빌트인 선언 자동 삽입**: `st` 사용 시 `vec2 st = gl_FragCoord.xy / resolution;` 자동 추가
- **종속성 관리**: 각 빌트인의 `needs_declaration` 플래그 활용
- **중복 제거**: 동일 빌트인 여러 번 사용 시 한 번만 선언

## 🔧 해결된 기술적 문제들

### A. 매개변수 이름 문법 오류
**문제**: `float st.x` 같은 비유효한 GLSL 매개변수명 생성
**해결**: 점을 언더바로 변경하여 `float st_x` 생성

### B. 리터럴 매개변수 누락
**문제**: `1.0` 같은 리터럴이 매개변수에서 제외되어 함수 호출 불일치
**해결**: `literal_N` 형태의 매개변수 자동 생성

### C. 유니폼 오생성
**문제**: `st.x`가 `uniform float st.x;` 형태로 잘못 생성
**해결**: swizzle 감지 후 기본 변수의 종속 유니폼만 생성

### D. 빌트인 선언 누락
**문제**: `st` 사용하지만 선언이 없어서 미정의 변수 오류
**해결**: 빌트인 메타데이터의 선언 코드 자동 삽입

## 📊 현재 시스템 상태

### ✅ 완전 구현된 기능
- [x] 빌트인 변수 관리 시스템 (BuiltinVariables 클래스)  
- [x] Swizzle 파싱 및 처리 (`st.x`, `st.xy` 등)
- [x] 타입 기반 성분 수 계산 시스템
- [x] 래핑 함수 매개변수명 안전성 보장
- [x] 리터럴 상수 매개변수 생성
- [x] 유니폼 생성 최적화
- [x] 빌트인 변수 자동 선언

### 🔄 테스트 상태
- **컴파일**: 모든 셰이더 성공적으로 컴파일됨
- **에러**: 런타임 에러 없음
- **시각적 출력**: 일부 케이스에서 검정 화면 (미해결 문제)

## ❌ 미해결 문제

### **렌더링 결과 불일치**
**증상**: 
- `["st", "time", "1.0"]` → 정상 노이즈 패턴 출력
- `["st.x", "time", "1.0"]` → 검정 화면만 출력

**분석된 차이점**:
- `st` 버전: `vec4` 오버로드, `snoise(vec2 st, float time, float literal_0)`
- `st.x` 버전: `vec3` 오버로드, `snoise(float st_x, float time, float literal_0)`

**추정 원인**:
1. **노이즈 차원성**: `st.x` (1차원) vs `st` (2차원) 노이즈의 시각적 차이
2. **값 범위**: 1차원 노이즈가 시각적으로 구분되지 않는 범위일 가능성
3. **색상 매핑**: 노이즈 값의 색상 변환 과정에서 문제

**상태**: 기술적으로는 올바르게 작동하지만 시각적 결과가 다름

## 🎯 다음 작업 계획

### 단기 (1-2일)
1. **렌더링 문제 디버깅**: 노이즈 값 범위 및 색상 매핑 분석
2. **다양한 swizzle 조합 테스트**: `st.xy`, `st.yx` 등
3. **노이즈 시각화 개선**: 값 범위 정규화 및 색상 강화

### 중기 (1주)
1. **추가 빌트인 변수**: `uv`, `pos`, `coord` 등
2. **복합 swizzle**: `st.xyx`, `resolution.xy` 등
3. **성능 최적화**: 빌트인 변수 캐싱 및 중복 제거

## 📈 성과 요약

오늘의 작업으로 GLSL 플러그인 시스템이 **완전한 swizzle 지원**과 **체계적인 빌트인 변수 관리**를 갖추게 되었습니다. 

**핵심 성과**:
- ✅ 문법적으로 안전한 래핑 함수 생성
- ✅ 타입 시스템 정교화  
- ✅ 빌트인 변수 메타데이터 관리
- ✅ 자동 유니폼 및 선언 생성